<div class="card">
    <div class="card-header border-0 pt-6">
        <div class="card-title">
            <div class="d-flex align-items-center position-relative my-1">
                <i class="fas fa-search fs-3 position-absolute ms-5"></i>
                <input
                type="text"
                [(ngModel)]="searchText"
                class="form-control form-control-solid w-250px ps-12"
                placeholder="Search Member Name"
                (input)="filterMembers()"
              />
            </div>
        </div>
        <div class="card-toolbar">
            <button class="btn btn-primary" (click)="openModal()">
                <i class="fas fa-plus-circle"></i> Add User
            </button>
        </div>
    </div>

    <div class="card-body pt-0">
        <table class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th>SI.No</th>
                    <th>Salutations</th>
                    <th>Member Type</th>
                    <th>Name of the Member</th>
                    <th>Designation of Member</th>
                    <th>Other Designation</th> <!-- Updated column name -->
                    <th>Date of Appointment</th>
                    <th>Validity</th>
                    <th>Level of Member</th>
                    <th>District</th>
                    <th>Subdivision</th>
                    <th>Status</th> <!-- Added Status column -->
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngIf="filteredMembers.length === 0">
                    <td colspan="9" class="text-center">No data found</td>
                  </tr>
                  <tr *ngFor="let member of filteredMembers | paginate: { itemsPerPage: 10, currentPage: page }; let i = index">
                    <td>{{ (page - 1) * 10 + i + 1 }}</td>
                    <td>{{ member.salutation || 'N/A' }}</td>
                    <td>{{ member.member_type || 'N/A' }}</td>
                    <td>{{ member.name || 'N/A' }}</td>
                    <td>{{ member.designation || 'N/A' }}</td>
                    <td>{{ member.other_designation || 'N/A' }}</td>
                    <td>{{ member.meeting_date | date: 'dd/MM/yyyy' }}</td>
                    <td>{{ member.validity_end_date | date: 'dd/MM/yyyy' }}</td>
                    <td>{{ member.level_of_member || 'N/A' }}</td>
                    <td>{{ member.district || 'N/A' }}</td>
                    <td>{{ member.subdivision || 'N/A' }}</td>
                    <td>
                      <span class="badge" [ngClass]="member.status == '1' ? 'badge-success' : 'badge-danger'">
                        {{ member.status == '1' ? 'Active' : 'Inactive' }}
                      </span>
                    </td>
                    <td>
                      <div ngbDropdown class="d-inline-block">
                        <button ngbDropdownToggle class="btn btn-sm btn-circle btn-icon btn-bg-light btn-active-color-primary">
                          <i class="bi bi-three-dots-vertical fs-3"></i>
                        </button>
                        <div ngbDropdownMenu>
                          <button ngbDropdownItem (click)="openModal(member)">Edit</button>
                          <button ngbDropdownItem (click)="deleteMember(member.vmc_id)">Delete</button>

                          <button ngbDropdownItem (click)="toggleStatus(member)">
                            {{ member.status == '1' ? 'Set Inactive' : 'Set Active' }}
                          </button>
                        </div>
                      </div>
                    </td>
                  </tr>

            </tbody>
        </table>

        <!-- Pagination Control -->
        <pagination-controls class="d-flex justify-content-end" (pageChange)="page = $event"></pagination-controls>
    </div>
</div>

<!-- Modal for Adding/Editing Member -->
<ng-template #memberModalAdd let-modal>
    <div class="modal-header">
      <h5 class="modal-title">{{ editIndex !== null ? 'Edit Member' : 'Add Member' }}</h5>
      <button type="button" class="btn-close" aria-label="Close" (click)="closeModal()"></button>
    </div>
    <div class="modal-body">
      <form  #myForm="ngForm" (ngSubmit)="onSubmit(myForm)">
        <div class="row mb-3">
          <!-- Salutation -->
          <div class="col-md-12">
            <label for="salutation" class="form-label">Salutations</label>
            <select
              class="form-select"
              id="salutation"
              name="salutation"
              [(ngModel)]="member.salutation"
              required
            >
              <option value="" disabled>Select Salutation</option>
              <option value="Mr">Mr</option>
              <option value="Ms">Ms</option>
              <option value="Dr">Dr</option>
            </select>
          </div>

          <!-- Member Type -->
          <div class="col-md-12 mt-3">
            <label for="member_type" class="form-label">Member Type</label>
            <select
              class="form-select"
              id="memberType"
              name="member_type: '',
"
              [(ngModel)]="member.member_type"
              required
            >
              <option value="" disabled>Select Member Type</option>
              <option value="Official Member">Official Member</option>
              <option value="Non-Official Member">Non-Official Member</option>
            </select>
          </div>

          <!-- Name -->
          <div class="col-md-12 mt-3">
            <label for="name" class="form-label">Name</label>
            <input
              type="text"
              class="form-control"
              id="name"
              name="name"
              [(ngModel)]="member.name"
              placeholder="Enter Name"
              required
            />
          </div>

          <!-- Designation -->
          <div class="col-md-12 mt-3">
            <label for="designation" class="form-label">Designation</label>
            <select
              class="form-select"
              id="designation"
              name="designation"
              [(ngModel)]="member.designation"
              required
            >
              <option value="" disabled>Select Designation</option>
              <option value="Chief Minister">Chief Minister</option>
              <option value="Minister Adi Dravidar Welfare">Minister, Adi Dravidar Welfare</option>
              <option value="Chief Secretary">Chief Secretary</option>
              <option value="Secretary Adi Dravidar and Tribal Welfare">Secretary, Adi Dravidar and Tribal Welfare</option>
              <option value="Director General of Police">Director General of Police</option>
              <option value="District Collector">District Collector</option>
              <option value="District Magistrate">District Magistrate</option>
              <option value="Sub-divisional magistrate">Sub-divisional magistrate</option>
              <option value="Superintendent of Police">Superintendent of Police</option>
              <option value="Special Public Prosecutor">Special Public Prosecutor</option>
              <option value="DADTWO">DADTWO</option>
              <option value="Others">Others</option>
            </select>
          </div>

          <!-- Other Designation -->
          <div class="col-md-12 mt-3" *ngIf="member.designation === 'Others'">
            <label for="otherDesignation" class="form-label">Other Designation</label>
            <input
              type="text"
              class="form-control"
              id="otherDesignation"
              name="otherDesignation"
              [(ngModel)]="member.other_designation"
              placeholder="Enter Other Designation"
              required
            />
          </div>

          <!-- Meeting Date -->
          <div class="col-md-12 mt-3">
            <label for="meetingDate" class="form-label">Date of Appointment</label>
            <input
              type="date"
              class="form-control"
              id="meetingDate"
              name="meetingDate"
              [(ngModel)]="member.meetingDate"
              required
            />
          </div>

          <!-- Validity End Date -->
          <div class="col-md-12 mt-3">
            <label for="validityEndDate" class="form-label">Validity End Date</label>
            <input
              type="date"
              class="form-control"
              id="validityEndDate"
              name="validityEndDate"
              [(ngModel)]="member.validityEndDate"
              required
            />
          </div>

          <div class="col-md-12 mt-3">
            <label for="levelOfMember" class="form-label">Level of Member</label>
            <select
              class="form-select"
              id="levelOfMember"
              name="levelOfMember"
              [(ngModel)]="member.level_of_member"
              (change)="onLevelChange(member.level_of_member)"
              required
            >
              <option value="" disabled>Select Level</option>
              <option value="State Level">State Level</option>
              <option value="District Level">District Level</option>
              <option value="Subdivision">Subdivision</option>
            </select>
          </div>

          <div class="col-md-12 mt-3">
            <label for="district" class="form-label">District</label>
            <select
  class="form-select"
  id="district"
  name="district"
  [(ngModel)]="member.district"
  (change)="onDistrictChange($event)"
  [disabled]="isDistrictDisabled"
  required
>
  <option value="" disabled>Select District</option>
  <option *ngFor="let district of districts" [value]="district.district">
    {{ district.district }}
  </option>
</select>

          </div>

          <div class="col-md-12 mt-3">
            <label for="subdivision" class="form-label">Subdivision</label>
            <select
  class="form-select"
  id="subdivision"
  name="subdivision"
  [(ngModel)]="member.subdivision"
  [disabled]="isSubdivisionDisabled || !subdivisions.length"
  required
>
  <option value="" disabled>Select Subdivision</option>
  <option *ngFor="let subdivision of subdivisions" [value]="subdivision">
    {{ subdivision }}
  </option>
</select>

          </div>



        </div>

        <div class="d-flex justify-content-center">
          <button type="submit" class="btn btn-primary" [disabled]="!myForm.valid || isInvalidBasedOnLevel()">
            {{ editIndex !== null ? 'Update' : 'Submit' }}
          </button>
        </div>
      </form>
    </div>
  </ng-template>


<!-- SweetAlert Success Message -->
<swal #successSwal></swal>
